# iEnvs 产品需求文档（PRD）

**版本：** 1.0
**日期：** 2026-02-08
**作者：** Product Team

---

## 1. 产品概述

### 1.1 产品名称
**iEnvs** - macOS 环境变量可视化管理工具

### 1.2 产品定位
iEnvs 是一款专为 macOS 平台设计的原生环境变量管理工具，旨在解决开发者和运维人员在终端环境变量管理中的痛点。通过可视化界面，用户可以轻松创建、管理和切换不同场景下的环境变量配置，告别繁琐的命令行操作和配置文件编辑。

### 1.3 目标用户
- **软件开发者**：需要在不同项目间切换开发环境（如 Node.js 版本、Python 虚拟环境路径等）
- **DevOps 工程师**：需要管理多套部署环境的凭证和配置
- **技术爱好者**：希望更好地理解和管理自己的 macOS 终端环境

### 1.4 核心价值
- 可视化管理，降低环境变量配置门槛
- 分组管理，支持多场景快速切换
- 自动同步到 shell 配置文件，永久生效
- 原生 macOS 体验，轻量级无依赖

---

## 2. 背景与痛点分析

### 2.1 当前现状
在 macOS 终端中管理环境变量通常有以下两种方式：

#### 方式 1：临时设置（`export` 命令）
```bash
export NODE_ENV=production
export API_KEY=abc123
```
**问题：**
- 仅在当前终端会话生效
- 关闭终端窗口后配置丢失
- 每次打开新终端都需要重新设置

#### 方式 2：永久设置（配置文件）
在 `~/.bashrc`、`~/.zshrc` 等文件中写入：
```bash
export NODE_ENV=production
export API_KEY=abc123
```
**问题：**
- 需要手动编辑配置文件，对新手不友好
- 配置混乱，难以追踪哪些变量正在生效
- 不同项目需要的环境变量不同，无法灵活切换
- 变量冲突时难以排查

### 2.2 核心痛点
1. **缺乏可视化管理界面**
   无法直观查看当前设置了哪些环境变量，变量来源不明确

2. **场景切换困难**
   前端项目、后端项目、数据分析项目需要不同的环境变量组合，手动修改配置文件效率低下

3. **配置文件维护复杂**
   `.zshrc` 等文件随时间变得臃肿混乱，注释缺失，难以理解每个变量的用途

4. **冲突检测缺失**
   多个工具或项目可能设置同名变量，导致意外覆盖，排查困难

5. **团队协作困难**
   无法方便地导出/导入环境配置，新成员入职需要逐一配置环境

### 2.3 用户场景示例
**场景 1：前端开发者 Alice**
- 公司项目使用 Node.js 14，需要设置 `NVM_DIR`、`NODE_ENV=development`
- 个人项目使用 Node.js 18，需要不同的 `PATH` 配置
- 每次切换项目都需要手动修改 `.zshrc`，容易出错

**场景 2：DevOps 工程师 Bob**
- 管理 3 套环境：开发、预发布、生产
- 每套环境有不同的 `AWS_ACCESS_KEY_ID`、`KUBECONFIG` 路径
- 当前需要注释/取消注释配置文件中的不同行，非常繁琐

**场景 3：数据科学家 Carol**
- 使用多个 Python 虚拟环境，每个项目的 `PYTHONPATH`、`JUPYTER_CONFIG_DIR` 不同
- 希望一键切换环境，而不是记忆复杂的激活命令

---

## 3. 核心功能需求

### 3.1 分组管理

#### 3.1.1 创建分组
- 用户可以创建新的环境变量分组
- 每个分组必须有唯一的名称（如 "前端开发"、"AWS 生产环境"）
- 支持为分组添加描述信息（可选）
- 分组名称长度限制：1-50 字符
- 分组名称不允许特殊字符：`/`、`\`、`:`

**界面要求：**
- 点击左下角 "+" 按钮创建新分组
- 弹出对话框输入分组名称和描述
- 实时验证名称唯一性

#### 3.1.2 编辑分组
- 可以修改分组名称和描述
- 双击分组名称进入编辑状态
- 支持右键菜单 "重命名"

#### 3.1.3 删除分组
- 删除前弹出二次确认对话框
- 显示将要删除的分组名称和变量数量
- 确认后从界面和配置文件中移除

#### 3.1.4 分组排序
- 支持拖拽调整分组顺序
- 顺序保存到本地数据中
- 排序不影响变量生效逻辑

### 3.2 环境变量 CRUD

#### 3.2.1 添加变量
- 在选中的分组内添加新变量
- 需要输入：
  - **变量名（Key）**：必填，符合环境变量命名规范（字母、数字、下划线，不以数字开头）
  - **变量值（Value）**：必填，支持任意字符串
- 支持批量添加：粘贴多行 `KEY=VALUE` 格式文本，自动解析

**界面要求：**
- 右侧详情区域顶部有 "+" 按钮
- 点击后在变量列表顶部插入空白行，进入编辑状态
- 支持 Tab 键在 Key 和 Value 之间切换
- 支持 Enter 键保存，Esc 键取消

#### 3.2.2 编辑变量
- 双击变量行进入编辑状态
- 可以修改 Key 和 Value
- 修改 Key 时检查分组内是否存在同名变量

#### 3.2.3 删除变量
- 选中变量后按 Delete 键或点击 "-" 按钮
- 支持多选批量删除
- 删除前无需二次确认（因为可以通过 Command+Z 撤销）

#### 3.2.4 变量验证
- **Key 验证规则：**
  - 只能包含字母、数字、下划线
  - 不能以数字开头
  - 长度 1-255 字符
  - 大小写敏感

- **Value 验证规则：**
  - 支持任意字符串
  - 长度限制：0-10000 字符
  - 支持换行（但在 shell 中可能需要转义）

### 3.3 分组启用/禁用

#### 3.3.1 启用机制
- 每个分组旁有一个开关控件
- **启用状态：**
  - 开关显示为蓝色（或绿色）
  - 应用会在 shell 配置文件中写入该分组的 export 语句
  - 写入格式：
    ```bash
    # iEnvs Group: 前端开发 [ID: abc123] - START
    export NODE_ENV=development
    export PATH=/usr/local/bin/node:$PATH
    # iEnvs Group: 前端开发 [ID: abc123] - END
    ```
  - 使用特殊注释标记，方便后续识别和移除

#### 3.3.2 禁用机制
- **禁用状态：**
  - 开关显示为灰色
  - 应用会从 shell 配置文件中移除该分组的所有 export 语句
  - 删除对应的注释块（从 START 到 END）

#### 3.3.3 多分组启用策略
- 允许同时启用多个分组
- 如果多个分组包含同名变量：
  - 按照分组顺序，后面的分组覆盖前面的
  - 在界面上显示冲突警告（见 3.7）

#### 3.3.4 Shell 重载提示
- 启用/禁用后，显示通知提示：
  - "配置已更新，请重启终端或运行 `source ~/.zshrc` 使其生效"
- 提供 "复制命令" 按钮，方便用户快速执行

### 3.4 Shell 配置文件集成

#### 3.4.1 自动检测 Shell 类型
- 启动时检测用户默认 Shell：
  - 读取 `$SHELL` 环境变量
  - 识别 bash 或 zsh
- 根据 Shell 类型确定配置文件路径：
  - **Bash：** `~/.bashrc` 或 `~/.bash_profile`（如果 `.bashrc` 不存在）
  - **Zsh：** `~/.zshrc`

#### 3.4.2 配置文件写入策略
- **首次写入：**
  - 如果配置文件中没有 iEnvs 的标记，在文件末尾添加：
    ```bash
    # ========== iEnvs Managed Variables ==========
    # Warning: Do not manually edit this section
    # Managed by iEnvs - https://github.com/yourname/ienvs

    # iEnvs Group: 分组名 [ID: xxx] - START
    export KEY=VALUE
    # iEnvs Group: 分组名 [ID: xxx] - END

    # ========== End of iEnvs Managed Variables ==========
    ```

- **更新写入：**
  - 查找对应分组的 START/END 注释块
  - 替换块内的所有 export 语句
  - 保持块外的内容不变

- **删除：**
  - 禁用分组时，删除对应的注释块
  - 如果所有分组都禁用，删除整个 iEnvs 管理区域

#### 3.4.3 备份机制
- 每次修改配置文件前，自动创建备份：
  - 备份路径：`~/.zshrc.ienvs.backup.YYYYMMDD_HHMMSS`
  - 最多保留 10 个备份文件，自动清理旧备份
- 提供 "恢复备份" 功能（在设置中）

#### 3.4.4 权限处理
- 检测配置文件是否有写权限
- 如果权限不足，弹出提示：
  - "无法写入 ~/.zshrc，请检查文件权限"
  - 提供 "在 Finder 中显示" 按钮

### 3.5 搜索与过滤

#### 3.5.1 全局搜索
- 界面顶部提供搜索框
- 输入关键词后，实时过滤：
  - 匹配分组名称
  - 匹配变量名（Key）
  - 匹配变量值（Value）
- 高亮显示匹配内容

#### 3.5.2 分组内过滤
- 选中分组后，在右侧详情区域顶部显示过滤输入框
- 只过滤当前分组的变量
- 支持正则表达式（可选开关）

#### 3.5.3 搜索历史
- 记录最近 10 次搜索关键词
- 点击搜索框时显示下拉列表

### 3.6 导入导出

#### 3.6.1 导出分组
- 选中一个或多个分组，点击 "导出" 按钮
- 导出为 JSON 文件，格式示例：
  ```json
  {
    "version": "1.0",
    "exportDate": "2026-02-08T10:30:00Z",
    "groups": [
      {
        "id": "abc123",
        "name": "前端开发",
        "description": "Node.js 前端项目环境",
        "enabled": true,
        "variables": [
          {"key": "NODE_ENV", "value": "development"},
          {"key": "PATH", "value": "/usr/local/bin/node:$PATH"}
        ]
      }
    ]
  }
  ```
- 文件命名建议：`ienvs-export-YYYYMMDD.json`

#### 3.6.2 导入分组
- 点击 "导入" 按钮，选择 JSON 文件
- 验证 JSON 格式和版本兼容性
- 导入策略：
  - 如果分组名称已存在，弹出选项：
    - "跳过"
    - "覆盖"
    - "重命名为 [原名称]-导入"
  - 导入后不自动启用分组

#### 3.6.3 导出为 Shell 脚本
- 支持将分组导出为独立的 `.sh` 脚本
- 格式示例：
  ```bash
  #!/bin/bash
  # iEnvs Export: 前端开发
  # Generated: 2026-02-08 10:30:00

  export NODE_ENV=development
  export PATH=/usr/local/bin/node:$PATH
  ```
- 用户可以直接在终端运行 `source script.sh`

### 3.7 冲突检测

#### 3.7.1 同组内冲突
- 不允许在同一分组内添加同名变量
- 添加时实时检测，如果重复则显示错误提示

#### 3.7.2 跨分组冲突
- 当多个启用的分组包含同名变量时：
  - 在左侧分组列表中，冲突的分组旁显示警告图标
  - 在右侧变量列表中，冲突的变量行高亮显示
  - 悬停时显示 Tooltip：
    - "变量 NODE_ENV 在以下分组中重复：前端开发、后端开发"
    - "当前生效值：development（来自 前端开发）"

#### 3.7.3 冲突解决建议
- 在冲突详情面板中，显示：
  - 所有包含该变量的分组列表
  - 每个分组中的变量值
  - 当前生效的值（根据分组顺序判断）
- 提供快速操作：
  - "只保留此分组的变量，禁用其他"
  - "重命名变量"

---

## 4. 界面设计需求

### 4.1 整体布局
- **窗口结构：** 双栏布局
  - **左侧栏（宽度 250px，可调整）：** 分组列表
  - **右侧栏：** 当前选中分组的变量详情

### 4.2 左侧分组列表

#### 4.2.1 分组项组成
- **启用开关：** 位于最左侧，NSSwitch 控件
- **分组名称：** 主标题，字体 SF Pro Text Medium 14pt
- **变量数量：** 副标题，灰色小字，如 "3 个变量"
- **警告图标：** 如果存在冲突，显示黄色警告三角形

#### 4.2.2 操作按钮
- 列表底部固定工具栏：
  - **"+" 按钮：** 创建新分组
  - **"-" 按钮：** 删除选中分组（禁用状态：未选中时灰色）
  - **齿轮图标：** 打开设置面板

#### 4.2.3 交互行为
- 单击选中分组，右侧显示变量详情
- 双击分组名称进入重命名模式
- 右键菜单：
  - 重命名
  - 删除
  - 导出此分组
  - 复制分组（创建副本）
- 拖拽调整顺序，显示插入位置指示线

### 4.3 右侧变量详情

#### 4.3.1 标题栏
- 显示当前分组名称，字体 SF Pro Display Bold 18pt
- 右侧工具按钮：
  - **"+" 按钮：** 添加新变量
  - **"-" 按钮：** 删除选中变量
  - **搜索框：** 过滤当前分组变量

#### 4.3.2 变量列表
- **列布局：**
  - **列 1 - 变量名（Key）：** 宽度 40%，左对齐
  - **列 2 - 变量值（Value）：** 宽度 60%，左对齐
- **列表项样式：**
  - 高度 32px
  - 悬停时显示浅灰色背景
  - 选中时显示蓝色背景
  - 冲突变量显示黄色背景 + 警告图标

#### 4.3.3 空状态
- 当分组没有变量时，显示：
  - 大图标（虚线框加号）
  - 提示文字："此分组暂无环境变量，点击 + 添加"

#### 4.3.4 编辑模式
- 双击变量行或点击 "+" 按钮，进入编辑模式
- 显示两个文本输入框（Key 和 Value）
- 输入框下方显示实时验证错误（红色文字）
- 编辑栏右侧显示：
  - **"✓" 按钮：** 保存
  - **"✗" 按钮：** 取消

### 4.4 顶部工具栏

- **搜索框：** 全局搜索，宽度 200px
- **导入按钮：** "Import" 文字按钮
- **导出按钮：** "Export" 文字按钮
- **帮助按钮：** "?" 图标，点击打开帮助文档

### 4.5 设置面板

#### 4.5.1 通用设置
- **默认 Shell：** 下拉选择（Bash / Zsh）
- **配置文件路径：** 显示当前路径，支持自定义
- **自动备份：** 开关
- **最大备份数量：** 数字输入框（5-20）

#### 4.5.2 外观设置
- **主题：** 自动 / 浅色 / 深色
- **字体大小：** 小 / 中 / 大

#### 4.5.3 高级设置
- **启用冲突检测：** 开关
- **启用正则搜索：** 开关
- **导出时包含禁用分组：** 开关

#### 4.5.4 备份管理
- 列表显示所有备份文件
- 每项显示：备份时间、文件大小
- 支持恢复备份、删除备份

### 4.6 深色模式适配

- 自动跟随系统外观
- **浅色模式配色：**
  - 背景：白色 #FFFFFF
  - 侧边栏背景：浅灰 #F5F5F5
  - 文字：深灰 #333333
  - 分隔线：浅灰 #E0E0E0

- **深色模式配色：**
  - 背景：深灰 #1E1E1E
  - 侧边栏背景：更深灰 #2D2D2D
  - 文字：浅灰 #E0E0E0
  - 分隔线：中灰 #3A3A3A

### 4.7 窗口特性

- **最小窗口尺寸：** 800x500 px
- **默认窗口尺寸：** 1000x650 px
- **标题栏：** 显示 "iEnvs"
- **窗口样式：** 标准 macOS 窗口，支持全屏
- **菜单栏集成：** 完整的 macOS 菜单栏

---

## 5. 非功能需求

### 5.1 性能要求
- **启动时间：** 应用启动到主界面显示 < 1 秒
- **响应时间：**
  - 切换分组 < 100ms
  - 添加/删除变量 < 50ms
  - 搜索结果返回 < 200ms（1000+ 变量规模）
- **内存占用：** 空闲状态 < 50MB，正常使用 < 100MB

### 5.2 可靠性
- **数据持久化：**
  - 所有操作实时保存到本地数据库
  - 应用崩溃后重启，数据不丢失
- **配置文件安全：**
  - 修改配置文件前必须备份
  - 写入失败时回滚，不破坏原配置
- **异常处理：**
  - 配置文件被手动修改时，能够正确识别和恢复
  - 权限不足时给出明确提示

### 5.3 易用性
- **新手引导：**
  - 首次启动时显示欢迎向导
  - 介绍核心功能和使用流程
  - 提供示例分组模板
- **错误提示：**
  - 所有错误信息使用中文
  - 提供明确的解决方案
- **键盘快捷键：**
  - `Command + N`：新建分组
  - `Command + F`：搜索
  - `Command + ,`：打开设置
  - `Command + Delete`：删除选中项
  - `Command + Z`：撤销

### 5.4 兼容性
- **系统版本：** 支持 macOS 13.0（Ventura）及以上
- **芯片架构：** 同时支持 Intel 和 Apple Silicon（Universal Binary）
- **Shell 兼容性：**
  - Bash 3.2+（macOS 自带版本）
  - Zsh 5.8+（macOS 默认）

### 5.5 安全性
- **数据隔离：**
  - 应用数据存储在用户目录下
  - 不访问系统敏感区域
- **权限申请：**
  - 仅申请必要的文件系统访问权限
  - 不申请网络权限（完全离线）
- **敏感信息保护：**
  - 支持为变量值添加 "敏感" 标记
  - 敏感变量值在界面上默认隐藏（显示为 ****）
  - 导出时可选择排除敏感变量

### 5.6 可维护性
- **代码规范：**
  - 遵循 Swift 官方编码风格
  - 所有公共接口必须有文档注释
- **测试覆盖：**
  - 核心逻辑单元测试覆盖率 > 80%
  - 提供 UI 自动化测试用例
- **日志记录：**
  - 记录所有配置文件修改操作
  - 日志存储在 `~/Library/Logs/iEnvs/`

---

## 6. 技术约束

### 6.1 技术栈限制
- **开发语言：** Swift 5.9+
- **UI 框架：** SwiftUI（原生 macOS 框架）
- **数据存储：** UserDefaults 或 Core Data（本地数据库）
- **依赖管理：** 无外部依赖，纯原生实现

### 6.2 禁止使用的技术
- **第三方框架：** 不使用任何第三方 SDK 或库
- **网络功能：** 不包含任何网络请求
- **云服务：** 不集成云同步、统计、分析等服务
- **Electron/Web 技术：** 不使用 Web 技术栈

### 6.3 开发环境
- **Xcode 版本：** Xcode 15.0+
- **最低部署目标：** macOS 13.0
- **代码签名：** 需要 Apple Developer 账号签名

---

## 7. 项目里程碑

### 7.1 MVP 版本（v1.0）
**预计 4-6 周**

**核心功能：**
- 分组的增删改查
- 环境变量的增删改查
- 分组启用/禁用（写入 .zshrc）
- 基础 UI（双栏布局）
- 本地数据持久化

**交付物：**
- 可运行的 macOS 应用
- 基础用户文档

### 7.2 Beta 版本（v1.1）
**预计 2-3 周**

**新增功能：**
- 搜索与过滤
- 导入/导出（JSON 格式）
- 冲突检测
- 深色模式适配
- 配置文件备份机制

### 7.3 正式版本（v1.2）
**预计 2 周**

**优化项：**
- 性能优化（大规模变量场景）
- 完整的错误处理
- 用户引导和帮助文档
- 自动化测试覆盖
- 应用签名和公证

---

## 8. 未来扩展功能（非当前版本）

### 8.1 团队协作
- 分组配置云端同步（iCloud）
- 团队配置模板库
- 权限管理（只读/编辑）

### 8.2 高级功能
- 支持加密存储敏感变量（Keychain 集成）
- 变量值支持引用其他变量（如 `PATH=$HOME/bin:$PATH`）
- 定时启用/禁用分组（按时间自动切换）
- 历史版本管理（变量修改历史）

### 8.3 跨平台
- Linux 版本支持
- 命令行工具（CLI 版本）

---

## 9. 风险与挑战

### 9.1 技术风险
| 风险 | 可能性 | 影响 | 应对措施 |
|------|--------|------|----------|
| 配置文件损坏导致 Shell 无法启动 | 中 | 高 | 强制备份机制 + 回滚功能 |
| 不同 Shell 版本语法差异 | 中 | 中 | 兼容性测试 + 保守的语法策略 |
| 用户手动修改 iEnvs 管理区域 | 高 | 中 | 清晰的注释标记 + 重新同步功能 |

### 9.2 用户体验风险
| 风险 | 可能性 | 影响 | 应对措施 |
|------|--------|------|----------|
| 用户不理解 "启用" 和 "生效" 的关系 | 高 | 中 | 新手引导 + 状态提示 |
| 变量冲突导致意外行为 | 中 | 高 | 明显的冲突警告 + 解决方案 |
| 误删除分组导致配置丢失 | 中 | 中 | 二次确认 + 撤销功能 |

### 9.3 市场风险
| 风险 | 可能性 | 影响 | 应对措施 |
|------|--------|------|----------|
| 目标用户群体过小 | 中 | 高 | 通过技术社区推广 + 开源策略 |
| 用户更倾向于使用命令行工具 | 中 | 中 | 强调可视化和易用性优势 |

---

## 10. 成功指标

### 10.1 产品指标（MVP 阶段）
- 活跃用户数 > 500
- 日均启动次数 > 1000
- 崩溃率 < 0.1%
- 用户留存率（7 天）> 40%

### 10.2 用户满意度
- App Store 评分 > 4.5 星
- 用户反馈响应率 > 90%
- 关键 Bug 修复周期 < 3 天

### 10.3 社区影响
- GitHub Stars > 1000（如果开源）
- 技术博客/教程引用 > 10 篇
- 开发者社区讨论热度进入 macOS 工具类前 20

---

## 11. 附录

### 11.1 术语表
| 术语 | 定义 |
|------|------|
| 环境变量 | 操作系统中用于存储配置信息的动态命名值 |
| 分组 | iEnvs 中用于组织环境变量的逻辑容器 |
| Shell 配置文件 | 如 .zshrc、.bashrc，终端启动时自动执行的脚本 |
| export 语句 | Shell 中设置环境变量的命令 |
| 冲突 | 多个分组中存在同名环境变量的情况 |

### 11.2 参考资料
- [Bash Manual](https://www.gnu.org/software/bash/manual/)
- [Zsh Documentation](https://zsh.sourceforge.io/Doc/)
- [macOS Human Interface Guidelines](https://developer.apple.com/design/human-interface-guidelines/macos)
- [SwiftUI Documentation](https://developer.apple.com/documentation/swiftui)

### 11.3 联系方式
- 产品负责人：[Your Name]
- 技术负责人：[Tech Lead Name]
- 项目仓库：https://github.com/yourname/ienvs

---

**文档变更历史**

| 版本 | 日期 | 作者 | 变更内容 |
|------|------|------|----------|
| 1.0 | 2026-02-08 | Product Team | 初始版本 |
